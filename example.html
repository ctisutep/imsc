<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no" />
    <title>Texas' Stickiness</title>
    <link rel="stylesheet" href="//js.arcgis.com/3.17/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="//js.arcgis.com/3.17/esri/css/esri.css">
<!--    <link rel="stylesheet" href="./css/styles.css" /> -->
  </head>
  <body class="claro">
    <div id="esri-map-container"></div>
    <div id="esri-basemapgallery-container" class="esriBasemapGallery"></div>
    <div id="esri-colorinfoslider-container">
      <div id="title"></div>
      <hr>
      <div>
        Theme:
        <select id="color-renderer-theme">
          <option value="high-to-low" selected>High to low</option>
          <option value="above-and-below">Above and below</option>
          <option value="centered-on">Centered on</option>
          <option value="extremes">Extremes</option>
        </select>
      </div>
      <div id="esri-colorinfoslider"></div>
      <input type="checkbox" id="sliderZoomButton"/> Show histogram detail
    </div>
  </body>
  <script src="//js.arcgis.com/3.17/"></script>
  <script>
    require([
      "dojo/_base/array",
      "dojo/dom",
      "dojo/number",
      "dojo/on",
      "esri/basemaps",
      "esri/Color",
      "esri/dijit/Basemap",
      "esri/dijit/BasemapGallery",
      "esri/dijit/ColorInfoSlider",
      "esri/dijit/util/busyIndicator",
      "esri/InfoTemplate",
      "esri/layers/FeatureLayer",
      "esri/map",
      "esri/plugins/FeatureLayerStatistics",
      "esri/renderers/smartMapping",
      "esri/symbols/SimpleFillSymbol",
      "esri/symbols/SimpleLineSymbol",
      "dojo/domReady!"
    ], function (
      array, dom, number, on,
      esriBasemaps, Color, Basemap, BasemapGallery, ColorInfoSlider, busyIndicator, 
      InfoTemplate, FeatureLayer, Map, FeatureLayerStatistics, smartMapping, 
      SimpleFillSymbol, SimpleLineSymbol
    ){
      

      var basemap = "gray";
      var theme = "high-to-low";
      //var fieldName= "SPATIALVER";Shape_Length,Shape_Area,hzdept_r,hzdepb_r,frag3to10_r,sieveno4_r,sieveno40_r,sieveno10_r,sieveno200_r,sandtotal_r,sandvc_r,sandco_r,aashind_r
      var fieldName = "sieveno4_r";

      var url = "http://irpsrvgis34.utep.edu/arcgis/rest/services/Texas/Stickiness_state/MapServer/0";
      var mapOptions = {basemap: basemap, center: [-99, 31.31], zoom: 6, level: 9};
      var map = new Map("esri-map-container", mapOptions);
      
      var featureLayer = new FeatureLayer(url, {outFields: ["*"]});
      var featureLayerStatistics = new FeatureLayerStatistics({layer: featureLayer, visible: false});
      //featureLayer.setDefinitionExpression("stickiness = 'friable'");
      featureLayer.setDefinitionExpression("AREASYMBOL LIKE 'TX003' OR AREASYMBOL LIKE 'TX103' OR AREASYMBOL LIKE 'TX135' OR AREASYMBOL LIKE 'TX301' OR AREASYMBOL LIKE 'TX317' OR AREASYMBOL LIKE 'TX329' OR AREASYMBOL LIKE 'TX371' OR AREASYMBOL LIKE 'TX389' OR AREASYMBOL LIKE 'TX443' OR AREASYMBOL LIKE 'TX461' OR AREASYMBOL LIKE 'TX475' OR AREASYMBOL LIKE 'TX495' OR AREASYMBOL LIKE 'TX615' OR AREASYMBOL LIKE 'TX606' OR AREASYMBOL LIKE 'TX618'");
      map.addLayer(featureLayer);

      var colorInfoSlider = new ColorInfoSlider({
        colorInfo: {
          stops:[
            {color: new Color([92,92,92]), label: "50", value: 50}, 
            {color: new Color([92,92,92]), label: "51", value: 51}
          ]
        }
      }, "esri-colorinfoslider");

      colorInfoSlider.startup();
      
      smartMapping.createColorRenderer({
        layer: featureLayer,
        field: fieldName,
        showOthers: false,
        basemap: basemap,
        theme: theme
        }).then(function (colorRenderer){
        //console.log("create color renderer is generated", colorRenderer);

        if (!featureLayer.visible) {
          featureLayer.show();
        }
        featureLayer.setRenderer(colorRenderer.renderer);
        featureLayer.redraw();
      });

    });
  </script>
</html>
