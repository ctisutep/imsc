<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no" />
    <title>Texas' Stickiness</title>
    <link rel="stylesheet" href="//js.arcgis.com/3.17/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="//js.arcgis.com/3.17/esri/css/esri.css">
<!--    <link rel="stylesheet" href="./css/styles.css" /> -->
  </head>
  <body class="claro">
    <div id="esri-map-container"></div>
    <div id="esri-basemapgallery-container" class="esriBasemapGallery"></div>
    <div id="esri-colorinfoslider-container">
      <div id="title"></div>
      <hr>
      <div>
        District:
        <select id="District">
          <option value="Abilene" selected>Abilene</option>
          <option value="Amarillo">Amarillo</option>
          <option value="Atlanta">Atlanta</option>
          <option value="Austin">Austin</option>
          <option value="Beaumont">Beaumont</option>
          <option value="Brownwood">Brownwood</option>
          <option value="Bryan">Bryan</option>
          <option value="Childress">Childress</option>
          <option value="CorpusChristi">Corpus Christi</option>
          <option value="Dallas">Dallas</option>
          <option value="ElPaso">El Paso</option>
          <option value="FortWorth">Fort Worth</option>
          <option value="Houston">Houston</option>
          <option value="Laredo">Laredo</option>
          <option value="Lubbock">Lubbock</option>
          <option value="Lufkin">Lufkin</option>
          <option value="Odessa">Odessa</option>
          <option value="Paris">Paris</option>
          <option value="Pharr">Pharr</option>
          <option value="SanAngelo">San Angelo</option>
          <option value="SanAntonio">San Antonio</option>
          <option value="Tyler">Tyler</option>
          <option value="Waco">Waco</option>
          <option value="WichitaFalls">Wichita Falls</option>
          <option value="Yoakum">Yoakum</option>
        </select>
      </div>
      <div id="esri-colorinfoslider"></div>
      <input type="checkbox" id="sliderZoomButton"/> Show histogram detail
    </div>
  </body>
  <script src="//js.arcgis.com/3.17/"></script>
  <script src="java/districts.java"></script>
  <script>
    require([
      "dojo/_base/array",
      "dojo/dom",
      "dojo/number",
      "dojo/on",
      "esri/basemaps",
      "esri/Color",
      "esri/dijit/Basemap",
      "esri/dijit/BasemapGallery",
      "esri/dijit/PopupTemplate",
      "esri/dijit/util/busyIndicator",
      "esri/InfoTemplate",
      "esri/layers/FeatureLayer",
      "esri/map",
      "esri/plugins/FeatureLayerStatistics",
      "esri/renderers/smartMapping",
      "esri/symbols/SimpleFillSymbol",
      "esri/symbols/SimpleLineSymbol",
      "dojo/domReady!"
    ], function (
      array, dom, number, on,
      esriBasemaps, Color, Basemap, BasemapGallery, PopupTemplate, busyIndicator, 
      InfoTemplate, FeatureLayer, Map, FeatureLayerStatistics, smartMapping, 
      SimpleFillSymbol, SimpleLineSymbol
    ){
      
      
      var basemap = "gray";
      var district = "ElPaso";
      //var fieldName= "SPATIALVER";Shape_Length,Shape_Area,hzdept_r,hzdepb_r,frag3to10_r,sieveno4_r,sieveno40_r,sieveno10_r,sieveno200_r,sandtotal_r,sandvc_r,sandco_r,aashind_r
      var fieldName = "sieveno4_r";

      var perUrl = "http://irpsrvgis37.utep.edu/arcgis/rest/services/Texas/Perimeters_joined/MapServer/0";
      var url = "http://irpsrvgis34.utep.edu/arcgis/rest/services/Texas/Stickiness_state/MapServer/0";
      var mapOptions = {basemap: basemap, center: [-99, 31.31], zoom: 6, level: 9};
      var map = new Map("esri-map-container", mapOptions);


      var popupTemplate = new PopupTemplate({
        title: "Property: " + fieldName,
        description: "{*}"
      });
      var perimeter = new FeatureLayer (perUrl, {outFields: ["*"]});
      var featureLayer = new FeatureLayer(url, {
        outFields: ["*"],
        infoTemplate: popupTemplate});
      var featureLayerStatistics = new FeatureLayerStatistics({layer: featureLayer, visible: false});
      
      featureLayer.setDefinitionExpression(SanAngelo + " AND hzdept_r < 30 AND hzdepb_r < 30");
      
      map.addLayer(perimeter);
      map.addLayer(featureLayer);
      
      smartMapping.createColorRenderer({
        layer: featureLayer,
        field: fieldName,
        showOthers: false,
        basemap: basemap,
        theme: theme
        }).then(function (colorRenderer){
        //console.log("create color renderer is generated", colorRenderer);

        if (!featureLayer.visible) {
          featureLayer.show();
        }
        featureLayer.setRenderer(colorRenderer.renderer);
        featureLayer.redraw();
      });
        dom.byId("District").onchange = function(){
          featureLayer.setDefinitionExpression(SanAngelo + " AND hzdept_r < 30 AND hzdepb_r < 30");
        }
    });
  </script>
</html>